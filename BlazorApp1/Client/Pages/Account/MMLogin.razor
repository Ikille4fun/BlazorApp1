@page "/account/login"
@using BlazorApp1.Shared.Components.Models.Account
@inject IAccountService AccountService
@inject NavigationManager NavigationManager
@using System.Net.Http
@inject HttpClient HttpClient

<div class="card">
    <h1 class="card-header">Login</h1>
    <div class="card-body">
        <EditForm Model="@model" OnSubmit="TLogin">
            <DataAnnotationsValidator />
            <div class="form-group">
                <label for="username">Username:</label>
                @*<input @Value="UserName" class="form-control" id="username" placeholder="Enter username" />*@
                <InputText @bind-Value="model.Username" class="form-control" id="username" placeholder="Enter username"/>
                <ValidationMessage For="@(() => model.Username)"/>
            </div>
            <div class="form-group">
                <label for="pwd">Password:</label>
                @*<input @Value="Password" class="form-control" id="password" placeholder="Enter password" type="password" />*@
                <InputText @bind-Value="model.Password" class="form-control" id="password" placeholder="Enter password" type="password"/>
                <ValidationMessage For="@(() => model.Password)"/>
            </div>
            <button class="btn btn-primary" type="submit" value="submit">Login</button>
            <button class="btn btn-primary" onclick="close()">Close</button>
        </EditForm>
    </div>
</div>


@code {

    private Login model = new Login();

    private async Task TLogin()
    {
        try
        {
            await HttpClient.PostAsJsonAsync("api/login", (model.Username, model.Password));
            //NavigationManager.NavigateTo("/audionote");
        }
        catch (Exception e)
        {
            Console.WriteLine("MMLogin.razor" + e);
            throw;
        }
    }

    private async void CLogin()
    {
        try
        {
            await AccountService.Login(model);
            var returnUrl = NavigationManager.QueryString("returnUrl") ?? "";
            NavigationManager.NavigateTo(returnUrl);
        }
        catch (Exception e)
        {
            Console.WriteLine("MMLogin.razor" + e);
            throw;
        }
    }

}